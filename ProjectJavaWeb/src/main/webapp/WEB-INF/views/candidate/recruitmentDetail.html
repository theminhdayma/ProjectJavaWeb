<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${position.name} + ' - InternSHIP'">Position Detail - InternSHIP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'red-custom': '#B91C1C',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">

<!-- Header -->
<div th:insert="candidate/layoutCandidate/header :: HEADER"></div>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
    <!-- Success Message -->
    <div th:if="${success}"
         id="successAlert"
         class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4 transition-opacity duration-500 ease-in-out"
         role="alert">
        <div class="flex items-center justify-between">
            <div class="flex">
                <div class="py-1">
                    <svg class="fill-current h-6 w-6 text-green-500 mr-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <path d="M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z"/>
                    </svg>
                </div>
                <div>
                    <p class="font-bold">Thành công!</p>
                    <p class="text-sm" th:text="${success}"></p>
                </div>
            </div>
            <!-- Close button -->
            <button type="button"
                    onclick="closeAlert('successAlert')"
                    class="text-green-500 hover:text-green-700 ml-4">
                <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
            </button>
        </div>
        <!-- Progress bar -->
        <div class="mt-2">
            <div class="w-full bg-green-200 rounded-full h-1">
                <div id="successProgress" class="bg-green-500 h-1 rounded-full transition-all duration-3000 ease-linear w-full"></div>
            </div>
        </div>
    </div>

    <!-- Error Message -->
    <div th:if="${error}"
         id="errorAlert"
         class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 transition-opacity duration-500 ease-in-out"
         role="alert">
        <div class="flex items-center justify-between">
            <div class="flex">
                <div class="py-1">
                    <svg class="fill-current h-6 w-6 text-red-500 mr-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <path d="M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm1.41-1.41A8 8 0 1 0 15.66 4.34 8 8 0 0 0 4.34 15.66zm9.9-8.49L11.41 10l2.83 2.83-1.41 1.41L10 11.41l-2.83 2.83-1.41-1.41L8.59 10 5.76 7.17l1.41-1.41L10 8.59l2.83-2.83 1.41 1.41z"/>
                    </svg>
                </div>
                <div>
                    <p class="font-bold">Lỗi!</p>
                    <p class="text-sm" th:text="${error}"></p>
                </div>
            </div>
            <!-- Close button -->
            <button type="button"
                    onclick="closeAlert('errorAlert')"
                    class="text-red-500 hover:text-red-700 ml-4">
                <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
            </button>
        </div>
        <!-- Progress bar -->
        <div class="mt-2">
            <div class="w-full bg-red-200 rounded-full h-1">
                <div id="errorProgress" class="bg-red-500 h-1 rounded-full transition-all duration-3000 ease-linear w-full"></div>
            </div>
        </div>
    </div>
</div>

<!-- Breadcrumb -->
<nav class="bg-gray-100 py-3">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center space-x-2 text-sm text-gray-600">
            <a th:href="@{/candidate/home}" class="hover:text-red-custom">Trang chủ</a>
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
            </svg>
            <a th:href="@{/candidate/home}" class="hover:text-red-custom">Vị trí tuyển dụng</a>
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
            </svg>
            <span class="text-gray-900 font-medium" th:text="${position.name}">Position Name</span>
        </div>
    </div>
</nav>

<!-- Main Content -->
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
        <!-- Left Column - Job Details -->
        <div class="lg:w-2/3">
            <!-- Job Header -->
            <div class="bg-white rounded-lg shadow-sm p-8 mb-6">
                <div class="flex items-start justify-between mb-6">
                    <div class="flex items-center">
                        <div class="w-16 h-16 bg-red-100 rounded-lg flex items-center justify-center mr-4">
                            <svg class="w-8 h-8 text-red-custom" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900 mb-2" th:text="${position.name}">Position Name</h1>
                            <p class="text-lg text-gray-600">Rikkei Education</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800 mb-2">
                            Đang tuyển
                        </span>
                        <p class="text-sm text-gray-500">
                            Hạn nộp:
                            <span th:if="${position.expiredDate != null}"
                                  th:text="${position.expiredDate.toString()}"></span>
                            <span th:if="${position.expiredDate == null}">Không giới hạn</span>
                        </p>
                    </div>
                </div>

                <!-- Job Meta Info -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                        </svg>
                        <span class="text-sm text-gray-600">Hà Nội</span>
                    </div>
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
                        </svg>
                        <span class="text-sm text-gray-600"
                              th:if="${position.minSalary != null and position.maxSalary != null}"
                              th:text="${#numbers.formatDecimal(position.minSalary, 0, 'COMMA', 0, 'POINT')} + ' - ' + ${#numbers.formatDecimal(position.maxSalary, 0, 'COMMA', 0, 'POINT')} + ' VND'">
                        </span>
                        <span class="text-sm text-gray-600"
                              th:if="${position.minSalary == null or position.maxSalary == null}">
                            Thỏa thuận
                        </span>
                    </div>
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                        </svg>
                        <span class="text-sm text-gray-600">Thực tập</span>
                    </div>
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                        </svg>
                        <span class="text-sm text-gray-600">
                            KN tối thiểu:
                            <span th:text="${position.minExperience != null ? position.minExperience + ' năm' : 'Không yêu cầu'}"></span>
                        </span>
                    </div>
                </div>

                <!-- Technology Tags -->
                <div class="flex flex-wrap gap-2 mb-6">
                    <span th:each="tech : ${position.technologies}"
                          class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full"
                          th:text="${tech.name}">Technology</span>
                    <span th:if="${#lists.isEmpty(position.technologies)}"
                          class="px-3 py-1 bg-gray-100 text-gray-600 text-sm rounded-full">
                        Chưa có công nghệ
                    </span>
                </div>

                <!-- Apply Button -->
                <button class="w-full md:w-auto bg-red-custom hover:bg-red-700 text-white px-8 py-3 rounded-md font-medium text-lg transition-colors">
                    Ứng tuyển ngay
                </button>
            </div>

            <!-- Job Description -->
            <div class="bg-white rounded-lg shadow-sm p-8 mb-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4">Mô tả công việc</h2>
                <div class="prose prose-gray max-w-none">
                    <p class="text-gray-600 whitespace-pre-line"
                       th:text="${position.description ?: 'Chưa có mô tả chi tiết'}">
                        Mô tả công việc sẽ được hiển thị ở đây...
                    </p>
                </div>
            </div>

            <!-- Requirements -->
            <div class="bg-white rounded-lg shadow-sm p-8 mb-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4">Yêu cầu</h2>
                <ul class="space-y-3 text-gray-600">
                    <li class="flex items-start">
                        <svg class="w-5 h-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        <span>Kinh nghiệm tối thiểu:
                            <span th:text="${position.minExperience != null ? position.minExperience + ' năm' : 'Không yêu cầu'}"></span>
                        </span>
                    </li>
                    <li class="flex items-start" th:each="tech : ${position.technologies}">
                        <svg class="w-5 h-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        <span>Có kinh nghiệm với <span th:text="${tech.name}"></span></span>
                    </li>
                    <li class="flex items-start">
                        <svg class="w-5 h-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        <span>Có khả năng làm việc nhóm và giao tiếp tốt</span>
                    </li>
                    <li class="flex items-start">
                        <svg class="w-5 h-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        <span>Đam mê học hỏi và phát triển bản thân</span>
                    </li>
                </ul>
            </div>

            <!-- Benefits -->
            <div class="bg-white rounded-lg shadow-sm p-8 mb-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4">Quyền lợi</h2>
                <ul class="space-y-3 text-gray-600">
                    <li class="flex items-start">
                        <svg class="w-5 h-5 text-blue-500 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                        <span>Được đào tạo và hướng dẫn bởi các chuyên gia giàu kinh nghiệm</span>
                    </li>
                    <li class="flex items-start">
                        <svg class="w-5 h-5 text-blue-500 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                        <span>Môi trường làm việc chuyên nghiệp và thân thiện</span>
                    </li>
                    <li class="flex items-start">
                        <svg class="w-5 h-5 text-blue-500 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                        <span>Cơ hội được làm việc với các dự án thực tế</span>
                    </li>
                    <li class="flex items-start">
                        <svg class="w-5 h-5 text-blue-500 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                        <span>Cơ hội được chuyển đổi thành nhân viên chính thức</span>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Right Column - Quick Apply -->
        <div class="lg:w-1/3">
            <div class="bg-white rounded-lg shadow-sm p-6 sticky top-4">
                <h3 class="text-lg font-bold text-gray-900 mb-6">Ứng tuyển nhanh</h3>

                <form class="space-y-4">
                    <!-- Candidate Info Display -->
                    <div class="bg-gray-50 rounded-lg p-4 mb-4">
                        <h4 class="font-medium text-gray-900 mb-2">Thông tin của bạn</h4>
                        <p class="text-sm text-gray-600" th:text="${currentUser.candidate.name}">Tên ứng viên</p>
                        <p class="text-sm text-gray-600" th:text="${currentUser.email}">email@example.com</p>
                        <p class="text-sm text-gray-600" th:text="${currentUser.candidate.phone}">Số điện thoại</p>
                    </div>

                    <!-- Submit Button -->
                    <button type="button"
                            class="w-full md:w-auto bg-red-custom hover:bg-red-700 text-white px-8 py-3 rounded-md font-medium text-lg transition-colors"
                            onclick="openApplyModal()">
                        Ứng tuyển ngay
                    </button>
                </form>

                <!-- Additional Info -->
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <div class="text-sm text-gray-600 space-y-2">
                        <div class="flex items-center">
                            <svg class="w-4 h-4 text-gray-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            <span>Phản hồi trong 3-5 ngày làm việc</span>
                        </div>
                        <div class="flex items-center">
                            <svg class="w-4 h-4 text-gray-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            <span>Quy trình phỏng vấn: 2 vòng</span>
                        </div>
                    </div>
                </div>

                <!-- Random Job Suggestions -->
                <div class="mt-8 pt-6 border-t border-gray-200">
                    <h4 class="font-medium text-gray-900 mb-4">Vị trí tương tự</h4>

                    <div class="space-y-4" th:if="${randomPositions != null and !#lists.isEmpty(randomPositions)}">
                        <div th:each="randomPos : ${randomPositions}"
                             class="border border-gray-200 rounded-lg p-4 hover:border-red-300 transition-colors">

                            <!-- Job Title and Company -->
                            <div class="mb-3">
                                <h5 class="font-semibold text-gray-900 text-sm mb-1"
                                    th:text="${randomPos.name}">Job Title</h5>
                                <p class="text-xs text-gray-500">Rikkei Education</p>
                            </div>

                            <!-- Job Info -->
                            <div class="space-y-2 mb-3">
                                <!-- Salary -->
                                <div class="flex items-center text-xs text-gray-600">
                                    <svg class="w-3 h-3 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
                                    </svg>
                                    <span th:if="${randomPos.minSalary != null and randomPos.maxSalary != null}"
                                          th:text="${#numbers.formatDecimal(randomPos.minSalary, 0, 'COMMA', 0, 'POINT')} + ' - ' + ${#numbers.formatDecimal(randomPos.maxSalary, 0, 'COMMA', 0, 'POINT')} + ' VND'"></span>
                                    <span th:if="${randomPos.minSalary == null or randomPos.maxSalary == null}">Thỏa thuận</span>
                                </div>

                                <!-- Experience -->
                                <div class="flex items-center text-xs text-gray-600">
                                    <svg class="w-3 h-3 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                    </svg>
                                    <span>KN: </span>
                                    <span th:text="${randomPos.minExperience != null ? randomPos.minExperience + ' năm' : 'Không yêu cầu'}"></span>
                                </div>

                                <!-- Deadline -->
                                <div class="flex items-center text-xs text-gray-600">
                                    <svg class="w-3 h-3 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                                    </svg>
                                    <span>Hạn: </span>
                                    <span th:if="${randomPos.expiredDate != null}"
                                          th:text="${randomPos.expiredDate.toString()}"></span>
                                    <span th:if="${randomPos.expiredDate == null}">Không giới hạn</span>
                                </div>
                            </div>

                            <!-- Technologies -->
                            <div class="flex flex-wrap gap-1 mb-3">
                <span th:each="tech : ${randomPos.technologies}"
                      class="px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded-full"
                      th:text="${tech.name}">Tech</span>
                                <span th:if="${#lists.isEmpty(randomPos.technologies)}"
                                      class="px-2 py-1 bg-gray-50 text-gray-500 text-xs rounded-full">
                    Chưa có công nghệ
                </span>
                            </div>

                            <!-- View Details Button -->
                            <a th:href="@{/candidate/home/recruitmentDetail/{id}(id=${randomPos.id})}"
                               class="inline-flex items-center text-xs text-red-custom hover:text-red-700 font-medium">
                                <span>Xem chi tiết</span>
                                <svg class="w-3 h-3 ml-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                                </svg>
                            </a>
                        </div>
                    </div>

                    <!-- Empty State -->
                    <div th:if="${randomPositions == null or #lists.isEmpty(randomPositions)}"
                         class="text-center py-8">
                        <svg class="mx-auto h-8 w-8 text-gray-400 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        <p class="text-sm text-gray-500">Không có vị trí tương tự</p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</main>

<!-- Apply Modal với form submit thông thường -->
<div id="applyModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
    <div class="relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
        <!-- Modal Header -->
        <div class="flex items-center justify-between pb-4 border-b">
            <h3 class="text-lg font-semibold text-gray-900">Ứng tuyển vị trí</h3>
            <button type="button" onclick="closeApplyModal()" class="text-gray-400 hover:text-gray-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>

        <!-- Modal Body -->
        <form th:action="@{/candidate/home/apply}" method="post" enctype="multipart/form-data" class="mt-4">
            <input type="hidden" name="positionId" th:value="${position.id}">

            <!-- File CV Section -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    File CV <span class="text-red-500">*</span>
                </label>

                <!-- File Upload Area -->
                <div id="fileUploadArea"
                     class="border-2 border-dashed border-red-300 rounded-lg p-8 text-center bg-red-50 hover:bg-red-100 transition-colors cursor-pointer"
                     onclick="document.getElementById('cvFile').click()">
                    <div id="uploadIcon" class="mb-4">
                        <svg class="mx-auto h-12 w-12 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                        </svg>
                    </div>
                    <div id="uploadText">
                        <p class="text-sm text-gray-600 mb-1">Nhấn để tải CV của bạn</p>
                        <p class="text-xs text-gray-500">PDF, DOC, DOCX (tối đa 5MB)</p>
                    </div>
                </div>

                <!-- Hidden File Input -->
                <input type="file"
                       id="cvFile"
                       name="cvFile"
                       accept=".pdf,.doc,.docx"
                       class="hidden"
                       onchange="handleFileSelect(this)"
                       required>

                <!-- File Info Display -->
                <div id="fileInfo" class="hidden mt-3 p-3 bg-green-50 border border-green-200 rounded-md">
                    <div class="flex items-center">
                        <svg class="h-5 w-5 text-green-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        <span id="fileName" class="text-sm text-green-800"></span>
                        <button type="button" onclick="removeFile()" class="ml-auto text-green-600 hover:text-green-800">
                            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Error Message -->
                <div id="fileError" class="hidden mt-2 text-sm text-red-600"></div>
            </div>

            <!-- Modal Footer -->
            <div class="flex items-center justify-end space-x-4 pt-4 border-t">
                <button type="button"
                        onclick="closeApplyModal()"
                        class="px-6 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">
                    Hủy
                </button>
                <button type="submit"
                        id="submitBtn"
                        class="px-6 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    <span id="submitText">Ứng tuyển</span>
                    <span id="submitLoader" class="hidden">
                        <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white inline" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Đang gửi...
                    </span>
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Footer -->
<div th:insert="candidate/layoutCandidate/footer :: FOOTER"></div>

<script>
    function openApplyModal() {
        document.getElementById('applyModal').classList.remove('hidden');
    }

    function closeApplyModal() {
        document.getElementById('applyModal').classList.add('hidden');
        resetForm();
    }

    function handleFileSelect(input) {
        const file = input.files[0];
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileError = document.getElementById('fileError');
        const uploadArea = document.getElementById('fileUploadArea');

        // Reset error state
        fileError.classList.add('hidden');
        uploadArea.classList.remove('border-red-500', 'bg-red-100');
        uploadArea.classList.add('border-red-300', 'bg-red-50');

        if (file) {
            // Validate file type
            const allowedTypes = ['application/pdf', 'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            if (!allowedTypes.includes(file.type)) {
                showFileError('Chỉ chấp nhận file PDF, DOC, DOCX');
                input.value = '';
                return;
            }

            // Validate file size (5MB)
            if (file.size > 5 * 1024 * 1024) {
                showFileError('File không được vượt quá 5MB');
                input.value = '';
                return;
            }

            // Show file info
            fileName.textContent = file.name + ' (' + formatFileSize(file.size) + ')';
            fileInfo.classList.remove('hidden');

            // Update upload area appearance
            uploadArea.classList.add('border-green-500', 'bg-green-50');
            uploadArea.classList.remove('border-red-300', 'bg-red-50');
        }
    }

    function showFileError(message) {
        const fileError = document.getElementById('fileError');
        const uploadArea = document.getElementById('fileUploadArea');

        fileError.textContent = message;
        fileError.classList.remove('hidden');
        uploadArea.classList.add('border-red-500', 'bg-red-100');
        uploadArea.classList.remove('border-red-300', 'bg-red-50');
    }

    function removeFile() {
        document.getElementById('cvFile').value = '';
        document.getElementById('fileInfo').classList.add('hidden');

        const uploadArea = document.getElementById('fileUploadArea');
        uploadArea.classList.remove('border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-100');
        uploadArea.classList.add('border-red-300', 'bg-red-50');
    }

    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function resetForm() {
        document.getElementById('cvFile').value = '';
        document.getElementById('fileInfo').classList.add('hidden');
        document.getElementById('fileError').classList.add('hidden');

        const uploadArea = document.getElementById('fileUploadArea');
        uploadArea.classList.remove('border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-100');
        uploadArea.classList.add('border-red-300', 'bg-red-50');
    }

    // Auto-hide alerts after 3 seconds
    document.addEventListener('DOMContentLoaded', function() {
        // Auto-hide success alert
        const successAlert = document.getElementById('successAlert');
        if (successAlert) {
            startAutoHide('successAlert', 'successProgress');
        }

        // Auto-hide error alert
        const errorAlert = document.getElementById('errorAlert');
        if (errorAlert) {
            startAutoHide('errorAlert', 'errorProgress');
        }

        // Auto-hide applied alert
        const appliedAlert = document.getElementById('appliedAlert');
        if (appliedAlert) {
            startAutoHide('appliedAlert', 'appliedProgress');
        }
    });

    function startAutoHide(alertId, progressId) {
        const alert = document.getElementById(alertId);
        const progress = document.getElementById(progressId);

        if (!alert || !progress) return;

        // Start progress bar animation
        setTimeout(() => {
            progress.style.width = '0%';
        }, 100);

        // Hide alert after 3 seconds
        setTimeout(() => {
            hideAlert(alertId);
        }, 3000);
    }

    function hideAlert(alertId) {
        const alert = document.getElementById(alertId);
        if (alert) {
            // Add fade out effect
            alert.style.opacity = '0';

            // Remove element after animation
            setTimeout(() => {
                alert.style.display = 'none';
            }, 500);
        }
    }

    function closeAlert(alertId) {
        hideAlert(alertId);
    }

    // Pause auto-hide when hovering
    function pauseAutoHide(alertId, progressId) {
        const alert = document.getElementById(alertId);
        const progress = document.getElementById(progressId);

        if (alert && progress) {
            alert.addEventListener('mouseenter', function() {
                progress.style.animationPlayState = 'paused';
            });

            alert.addEventListener('mouseleave', function() {
                progress.style.animationPlayState = 'running';
            });
        }
    }



</script>
</body>
</html>
